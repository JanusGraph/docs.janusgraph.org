



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Eventually-Consistent Storage Backends - JanusGraph</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../theme/structor-menu.css">
    
      <link rel="stylesheet" href="../../theme/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="green" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#eventually-consistent-storage-backends" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="JanusGraph" class="md-header-nav__button md-logo">
          
            <img src="../../janusgraph-logomark.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              JanusGraph
            </span>
            <span class="md-header-nav__topic">
              
                Eventually-Consistent Storage Backends
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/janusgraph/janusgraph/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    JanusGraph
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="JanusGraph" class="md-nav__button md-logo">
      
        <img src="../../janusgraph-logomark.svg" width="48" height="48">
      
    </a>
    JanusGraph
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/janusgraph/janusgraph/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    JanusGraph
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      JanusGraph Basics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        JanusGraph Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/schema/" title="Schema and Data Modeling" class="md-nav__link">
      Schema and Data Modeling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/gremlin/" title="Gremlin Query Language" class="md-nav__link">
      Gremlin Query Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/server/" title="JanusGraph Server" class="md-nav__link">
      JanusGraph Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/deployment/" title="Deployment Scenarios" class="md-nav__link">
      Deployment Scenarios
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/configured-graph-factory/" title="ConfiguredGraphFactory" class="md-nav__link">
      ConfiguredGraphFactory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/multi-node/" title="Things to Consider in a Multi-Node JanusGraph Cluster" class="md-nav__link">
      Things to Consider in a Multi-Node JanusGraph Cluster
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/index-performance/" title="Indexing for Better Performance" class="md-nav__link">
      Indexing for Better Performance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/transactions/" title="Transactions" class="md-nav__link">
      Transactions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/cache/" title="JanusGraph Cache" class="md-nav__link">
      JanusGraph Cache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/transaction-log/" title="Transaction Log" class="md-nav__link">
      Transaction Log
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/configuration-reference/" title="Configuration Reference" class="md-nav__link">
      Configuration Reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/example-config/" title="Config Example" class="md-nav__link">
      Config Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/common-questions/" title="Common Questions" class="md-nav__link">
      Common Questions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/technical-limitations/" title="Technical Limitations" class="md-nav__link">
      Technical Limitations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Storage Backends
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Storage Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage-backend/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage-backend/cassandra/" title="Apache Cassandra" class="md-nav__link">
      Apache Cassandra
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage-backend/hbase/" title="Apache HBase" class="md-nav__link">
      Apache HBase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage-backend/bigtable/" title="Google Cloud Bigtable" class="md-nav__link">
      Google Cloud Bigtable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage-backend/bdb/" title="Oracle Berkeley DB Java Edition" class="md-nav__link">
      Oracle Berkeley DB Java Edition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage-backend/inmemorybackend/" title="InMemory Storage Backend" class="md-nav__link">
      InMemory Storage Backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Index Backends
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Index Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/search-predicates/" title="Search Predicates and Data Types" class="md-nav__link">
      Search Predicates and Data Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/text-search/" title="Index Parameters and Full-Text Search" class="md-nav__link">
      Index Parameters and Full-Text Search
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/field-mapping/" title="Field Mapping" class="md-nav__link">
      Field Mapping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/direct-index-query/" title="Direct Index Query" class="md-nav__link">
      Direct Index Query
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/elasticsearch/" title="Elasticsearch" class="md-nav__link">
      Elasticsearch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/solr/" title="Apache Solr" class="md-nav__link">
      Apache Solr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/lucene/" title="Apache Lucene" class="md-nav__link">
      Apache Lucene
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Advanced Topics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Advanced Topics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../advschema/" title="Advanced Schema" class="md-nav__link">
      Advanced Schema
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Eventually-Consistent Storage Backends
      </label>
    
    <a href="./" title="Eventually-Consistent Storage Backends" class="md-nav__link md-nav__link--active">
      Eventually-Consistent Storage Backends
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-consistency" title="Data Consistency" class="md-nav__link">
    Data Consistency
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-consistency-without-locks" title="Data Consistency without Locks" class="md-nav__link">
    Data Consistency without Locks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#forking-edges" title="Forking Edges" class="md-nav__link">
    Forking Edges
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-properties" title="Multi-Properties" class="md-nav__link">
    Multi-Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-inconsistency" title="Data Inconsistency" class="md-nav__link">
    Data Inconsistency
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#temporary-inconsistency" title="Temporary Inconsistency" class="md-nav__link">
    Temporary Inconsistency
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ghost-vertices" title="Ghost Vertices" class="md-nav__link">
    Ghost Vertices
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../recovery/" title="Failure & Recovery" class="md-nav__link">
      Failure & Recovery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../index-admin/" title="Index Management" class="md-nav__link">
      Index Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bulk-loading/" title="Bulk Loading" class="md-nav__link">
      Bulk Loading
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../partitioning/" title="Graph Partitioning" class="md-nav__link">
      Graph Partitioning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../serializer/" title="Datatype and Attribute Serializer Configuration" class="md-nav__link">
      Datatype and Attribute Serializer Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hadoop/" title="JanusGraph with TinkerPop’s Hadoop-Gremlin" class="md-nav__link">
      JanusGraph with TinkerPop’s Hadoop-Gremlin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../monitoring/" title="Monitoring JanusGraph" class="md-nav__link">
      Monitoring JanusGraph
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../migrating/" title="Migrating from Titan" class="md-nav__link">
      Migrating from Titan
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data-model/" title="JanusGraph Data model" class="md-nav__link">
      JanusGraph Data model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../janusgraph-bus/" title="JanusGraph Bus" class="md-nav__link">
      JanusGraph Bus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Connecting to JanusGraph
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Connecting to JanusGraph
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../connecting/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../connecting/java/" title="Using Java" class="md-nav__link">
      Using Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../connecting/python/" title="Using Python" class="md-nav__link">
      Using Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../connecting/dotnet/" title="Using .Net" class="md-nav__link">
      Using .Net
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../development/" title="Development" class="md-nav__link">
      Development
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../appendices/" title="Appendices" class="md-nav__link">
      Appendices
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-consistency" title="Data Consistency" class="md-nav__link">
    Data Consistency
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-consistency-without-locks" title="Data Consistency without Locks" class="md-nav__link">
    Data Consistency without Locks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#forking-edges" title="Forking Edges" class="md-nav__link">
    Forking Edges
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-properties" title="Multi-Properties" class="md-nav__link">
    Multi-Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-inconsistency" title="Data Inconsistency" class="md-nav__link">
    Data Inconsistency
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#temporary-inconsistency" title="Temporary Inconsistency" class="md-nav__link">
    Temporary Inconsistency
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ghost-vertices" title="Ghost Vertices" class="md-nav__link">
    Ghost Vertices
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/janusgraph/janusgraph/edit/v0.2/docs/advanced-topics/eventual-consistency.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="eventually-consistent-storage-backends">Eventually-Consistent Storage Backends</h1>
<p>When running JanusGraph against an eventually consistent storage backend
special JanusGraph features must be used to ensure data consistency and
special considerations must be made regarding data degradation.</p>
<p>This page summarizes some of the aspects to consider when running
JanusGraph on top of an eventually consistent storage backend like
Apache Cassandra or Apache HBase.</p>
<h2 id="data-consistency">Data Consistency</h2>
<p>On eventually consistent storage backends, JanusGraph must obtain locks
in order to ensure consistency because the underlying storage backend
does not provide transactional isolation. In the interest of efficiency,
JanusGraph does not use locking by default. Hence, the user has to
decide for each schema element that defines a consistency constraint
whether or not to use locking. Use <code>JanusGraphManagement.setConsistency(element, ConsistencyModifier.LOCK)</code>
to explicitly enable locking on a schema element as shown in the
following examples.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">mgmt</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">openManagement</span><span class="o">()</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">mgmt</span><span class="o">.</span><span class="na">makePropertyKey</span><span class="o">(</span><span class="s1">&#39;consistentName&#39;</span><span class="o">).</span><span class="na">dataType</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">make</span><span class="o">()</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">mgmt</span><span class="o">.</span><span class="na">buildIndex</span><span class="o">(</span><span class="s1">&#39;byConsistentName&#39;</span><span class="o">,</span> <span class="n">Vertex</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">addKey</span><span class="o">(</span><span class="n">name</span><span class="o">).</span><span class="na">unique</span><span class="o">().</span><span class="na">buildCompositeIndex</span><span class="o">()</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">setConsistency</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">ConsistencyModifier</span><span class="o">.</span><span class="na">LOCK</span><span class="o">)</span> <span class="c1">// Ensures only one name per vertex</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">setConsistency</span><span class="o">(</span><span class="n">index</span><span class="o">,</span> <span class="n">ConsistencyModifier</span><span class="o">.</span><span class="na">LOCK</span><span class="o">)</span> <span class="c1">// Ensures name uniqueness in the graph</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">commit</span><span class="o">()</span>
</pre></div>
</td></tr></table></p>
<p>When updating an element that is guarded by a uniqueness constraint,
JanusGraph uses the following protocol at the end of a transaction when
calling <code>tx.commit()</code>:</p>
<ol>
<li>Acquire a lock on all elements that have a consistency constraint</li>
<li>Re-read those elements from the storage backend and verify that they
    match the state of the element in the current transaction prior to
    modification. If not, the element was concurrently modified and a
    PermanentLocking exception is thrown.</li>
<li>Persist the state of the transaction against the storage backend.</li>
<li>Release all locks.</li>
</ol>
<p>This is a brief description of the locking protocol which leaves out
optimizations (e.g. local conflict detection) and detection of failure
scenarios (e.g. expired locks).</p>
<p>The actual lock application mechanism is abstracted such that JanusGraph
can use multiple implementations of a locking provider. Currently, two
locking providers are supported in the JanusGraph distribution:</p>
<ol>
<li>A locking implementation based on key-consistent read and write
    operations that is agnostic to the underlying storage backend as
    long as it supports key-consistent operations (which includes
    Cassandra and HBase). This is the default implementation and uses
    timestamp based lock applications to determine which transaction
    holds the lock.</li>
<li>A Cassandra specific locking implementation based on the Astyanax
    locking recipe.</li>
</ol>
<p>Both locking providers require that clocks are synchronized across all
machines in the cluster.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The locking implementation is not robust against all failure
scenarios. For instance, when a Cassandra cluster drops below quorum,
consistency is no longer ensured. Hence, it is suggested to use
locking-based consistency constraints sparingly with eventually
consistent storage backends. For use cases that require strict and or
frequent consistency constraint enforcement, it is suggested to use a
storage backend that provides transactional isolation.</p>
</div>
<h3 id="data-consistency-without-locks">Data Consistency without Locks</h3>
<p>Because of the additional steps required to acquire a lock when
committing a modifying transaction, locking is a fairly expensive way to
ensure consistency and can lead to deadlock when very many concurrent
transactions try to modify the same elements in the graph. Hence,
locking should be used in situations where consistency is more important
than write latency and the number of conflicting transactions is small.</p>
<p>In other situations, it may be better to allow conflicting transactions
to proceed and to resolve inconsistencies at read time. This is a design
pattern commonly employed in large scale data systems and most effective
when the actual likelihood of conflict is small. Hence, write
transactions don’t incur additional overhead and any (unlikely) conflict
that does occur is detected and resolved at read time and later cleaned
up. JanusGraph makes it easy to use this strategy through the following
features.</p>
<h4 id="forking-edges">Forking Edges</h4>
<p>Because edge are stored as single records in the underlying storage
backend, concurrently modifying a single edge would lead to conflict.
Instead of locking, an edge label can be configured to use
<code>ConsistencyModifier.FORK</code>. The following example creates a new edge
label <code>related</code> and defines its consistency to FORK.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">mgmt</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">openManagement</span><span class="o">()</span>
<span class="n">related</span> <span class="o">=</span> <span class="n">mgmt</span><span class="o">.</span><span class="na">makeEdgeLabel</span><span class="o">(</span><span class="s1">&#39;related&#39;</span><span class="o">).</span><span class="na">make</span><span class="o">()</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">setConsistency</span><span class="o">(</span><span class="n">related</span><span class="o">,</span> <span class="n">ConsistencyModifier</span><span class="o">.</span><span class="na">FORK</span><span class="o">)</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">commit</span><span class="o">()</span>
</pre></div>
</td></tr></table>

<p>When modifying an edge whose label is configured to FORK the edge is
deleted and the modified edge is added as a new one. Hence, if two
concurrent transactions modify the same edge, two modified copies of the
edge will exist upon commit which can be resolved during querying
traversals if needed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Edge forking only applies to MULTI edges. Edge labels with a
multiplicity constraint cannot use this strategy since a constraint is
built into the edge label definition that requires an explicit lock or
use the conflict resolution mechanism of the underlying storage
backend.</p>
</div>
<h4 id="multi-properties">Multi-Properties</h4>
<p>Modifying single valued properties on vertices concurrently can result
in a conflict. Similarly to edges, one can allow an arbitrary number of
properties on a vertex for a particular property key defined with
cardinality LIST and FORK on modification. Hence, instead of conflict
one reads multiple properties. Since JanusGraph allows properties on
properties, provenance information like <code>author</code> can be added to the
properties to facilitate resolution at read time.</p>
<p>See <a href="../../basics/schema/#property-key-cardinality">multi-properties</a> to learn how to define
those.</p>
<h2 id="data-inconsistency">Data Inconsistency</h2>
<h3 id="temporary-inconsistency">Temporary Inconsistency</h3>
<p>On eventually consistent storage backends, writes may not be immediately
visible to the entire cluster causing temporary inconsistencies in the
graph. This is an inherent property of eventual consistency, in the
sense, that accepted updates must be propagated to other instances in
the cluster and no guarantees are made with respect to read atomicity in
the interest of performance.</p>
<p>From JanusGraph’s perspective, eventual consistency might cause the
following temporary graph inconsistencies in addition the general
inconsistency that some parts of a transaction are visible while others
aren’t yet.</p>
<p><strong>Stale Index entries</strong><br />
Index entries might point to nonexistent vertices or edges. Similarly, a
vertex or edge appears in the graph but is not yet indexed and hence
ignored by global graph queries.</p>
<p><strong>Half-Edges</strong><br />
Only one direction of an edge gets persisted or deleted which might lead
to the edge not being or incorrectly being retrieved.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to avoid that write failures result in permanent
inconsistencies in the graph it is recommended to use storage backends
that support batch write atomicity and to ensure that write atomicity
is enabled. To get the benefit of write atomicity, the number
modifications made in a single transaction must be smaller than the
configured <code>buffer-size</code> option documented in <a href="../../basics/configuration-reference/">Configuration Reference</a>. The
buffer size defines the maximum number of modifications that
JanusGraph will persist in a single batch. If a transaction has more
modifications, the persistence will be split into multiple batches
which are persisted individually which is useful for batch loading but
invalidates write atomicity.</p>
</div>
<h3 id="ghost-vertices">Ghost Vertices</h3>
<p>A permanent inconsistency that can arise when operating JanusGraph on
eventually consistent storage backend is the phenomena of <strong>ghost
vertices</strong>. If a vertex gets deleted while it is concurrently being
modified, the vertex might re-appear as a <em>ghost</em>.</p>
<p>The following strategies can be used to mitigate this issue:</p>
<p><strong>Existence checks</strong><br />
Configure transactions to (double) check for the existence of vertices
prior to returning them. Please see <a href="../../basics/transactions/#transaction-configuration">Transaction Configuration</a> for more
information and note that this can significantly decrease performance.
Note, that this does not fix the inconsistencies but hides some of them
from the user.</p>
<p><strong>Regular Clean-ups</strong><br />
Run regular batch-jobs to repair inconsistencies in the graph using
<a href="../hadoop/">JanusGraph with TinkerPop’s Hadoop-Gremlin</a>. 
This is the only strategy that can address all
inconsistencies and effectively repair them. We will provide increasing
support for such repairs in future versions of Faunus.</p>
<p><strong>Soft Deletes</strong><br />
Instead of deleting vertices, they are marked as deleted which keeps
them in the graph for future analysis but hides them from user-facing
transactions.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../advschema/" title="Advanced Schema" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Advanced Schema
              </span>
            </div>
          </a>
        
        
          <a href="../recovery/" title="Failure & Recovery" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Failure & Recovery
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 JanusGraph Authors. All rights reserved.<br> The Linux Foundation has registered trademarks and uses trademarks. For a list of<br> trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage</a> page.<br> Cassandra, Groovy, HBase, Hadoop, Lucene, Solr, and TinkerPop are trademarks of the Apache Software Foundation.<br> Berkeley DB and Berkeley DB Java Edition are trademarks of Oracle.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../theme/js/structor-menu.js"></script>
      
    
  </body>
</html>