



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Transaction Log - JanusGraph</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../theme/structor-menu.css">
    
      <link rel="stylesheet" href="../../theme/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="green" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#transaction-log" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="JanusGraph" class="md-header-nav__button md-logo">
          
            <img src="../../janusgraph-logomark.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              JanusGraph
            </span>
            <span class="md-header-nav__topic">
              
                Transaction Log
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/janusgraph/janusgraph/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    JanusGraph
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="JanusGraph" class="md-nav__button md-logo">
      
        <img src="../../janusgraph-logomark.svg" width="48" height="48">
      
    </a>
    JanusGraph
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/janusgraph/janusgraph/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    JanusGraph
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      JanusGraph Basics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        JanusGraph Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../schema/" title="Schema and Data Modeling" class="md-nav__link">
      Schema and Data Modeling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gremlin/" title="Gremlin Query Language" class="md-nav__link">
      Gremlin Query Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../server/" title="JanusGraph Server" class="md-nav__link">
      JanusGraph Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment/" title="Deployment Scenarios" class="md-nav__link">
      Deployment Scenarios
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configured-graph-factory/" title="ConfiguredGraphFactory" class="md-nav__link">
      ConfiguredGraphFactory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multi-node/" title="Things to Consider in a Multi-Node JanusGraph Cluster" class="md-nav__link">
      Things to Consider in a Multi-Node JanusGraph Cluster
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../index-performance/" title="Indexing for Better Performance" class="md-nav__link">
      Indexing for Better Performance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../transactions/" title="Transactions" class="md-nav__link">
      Transactions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cache/" title="JanusGraph Cache" class="md-nav__link">
      JanusGraph Cache
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Transaction Log
      </label>
    
    <a href="./" title="Transaction Log" class="md-nav__link md-nav__link--active">
      Transaction Log
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#transaction-log-use-cases" title="Transaction Log Use Cases" class="md-nav__link">
    Transaction Log Use Cases
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#record-of-change" title="Record of Change" class="md-nav__link">
    Record of Change
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downstream-updates" title="Downstream Updates" class="md-nav__link">
    Downstream Updates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triggers" title="Triggers" class="md-nav__link">
    Triggers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#log-configuration" title="Log Configuration" class="md-nav__link">
    Log Configuration
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configuration-reference/" title="Configuration Reference" class="md-nav__link">
      Configuration Reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../example-config/" title="Config Example" class="md-nav__link">
      Config Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../common-questions/" title="Common Questions" class="md-nav__link">
      Common Questions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../technical-limitations/" title="Technical Limitations" class="md-nav__link">
      Technical Limitations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Storage Backends
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Storage Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage-backend/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage-backend/cassandra/" title="Apache Cassandra" class="md-nav__link">
      Apache Cassandra
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage-backend/hbase/" title="Apache HBase" class="md-nav__link">
      Apache HBase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage-backend/bigtable/" title="Google Cloud Bigtable" class="md-nav__link">
      Google Cloud Bigtable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage-backend/bdb/" title="Oracle Berkeley DB Java Edition" class="md-nav__link">
      Oracle Berkeley DB Java Edition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage-backend/inmemorybackend/" title="InMemory Storage Backend" class="md-nav__link">
      InMemory Storage Backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Index Backends
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Index Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/search-predicates/" title="Search Predicates and Data Types" class="md-nav__link">
      Search Predicates and Data Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/text-search/" title="Index Parameters and Full-Text Search" class="md-nav__link">
      Index Parameters and Full-Text Search
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/field-mapping/" title="Field Mapping" class="md-nav__link">
      Field Mapping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/direct-index-query/" title="Direct Index Query" class="md-nav__link">
      Direct Index Query
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/elasticsearch/" title="Elasticsearch" class="md-nav__link">
      Elasticsearch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/solr/" title="Apache Solr" class="md-nav__link">
      Apache Solr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index-backend/lucene/" title="Apache Lucene" class="md-nav__link">
      Apache Lucene
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Advanced Topics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Advanced Topics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-topics/advschema/" title="Advanced Schema" class="md-nav__link">
      Advanced Schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-topics/eventual-consistency/" title="Eventually-Consistent Storage Backends" class="md-nav__link">
      Eventually-Consistent Storage Backends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-topics/recovery/" title="Failure & Recovery" class="md-nav__link">
      Failure & Recovery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-topics/index-admin/" title="Index Management" class="md-nav__link">
      Index Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-topics/bulk-loading/" title="Bulk Loading" class="md-nav__link">
      Bulk Loading
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-topics/partitioning/" title="Graph Partitioning" class="md-nav__link">
      Graph Partitioning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-topics/serializer/" title="Datatype and Attribute Serializer Configuration" class="md-nav__link">
      Datatype and Attribute Serializer Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-topics/hadoop/" title="JanusGraph with TinkerPop’s Hadoop-Gremlin" class="md-nav__link">
      JanusGraph with TinkerPop’s Hadoop-Gremlin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-topics/monitoring/" title="Monitoring JanusGraph" class="md-nav__link">
      Monitoring JanusGraph
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-topics/migrating/" title="Migrating from Titan" class="md-nav__link">
      Migrating from Titan
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-topics/data-model/" title="JanusGraph Data model" class="md-nav__link">
      JanusGraph Data model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-topics/janusgraph-bus/" title="JanusGraph Bus" class="md-nav__link">
      JanusGraph Bus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Connecting to JanusGraph
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Connecting to JanusGraph
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../connecting/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../connecting/java/" title="Using Java" class="md-nav__link">
      Using Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../connecting/python/" title="Using Python" class="md-nav__link">
      Using Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../connecting/dotnet/" title="Using .Net" class="md-nav__link">
      Using .Net
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../development/" title="Development" class="md-nav__link">
      Development
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../appendices/" title="Appendices" class="md-nav__link">
      Appendices
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#transaction-log-use-cases" title="Transaction Log Use Cases" class="md-nav__link">
    Transaction Log Use Cases
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#record-of-change" title="Record of Change" class="md-nav__link">
    Record of Change
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downstream-updates" title="Downstream Updates" class="md-nav__link">
    Downstream Updates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triggers" title="Triggers" class="md-nav__link">
    Triggers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#log-configuration" title="Log Configuration" class="md-nav__link">
    Log Configuration
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/janusgraph/janusgraph/edit/master/docs/basics/transaction-log.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="transaction-log">Transaction Log</h1>
<p>JanusGraph can automatically log transactional changes for additional
processing or as a record of change. To enable logging for a particular
transaction, specify the name of the target log during the start of the
transaction.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">tx</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">buildTransaction</span><span class="o">().</span><span class="na">logIdentifier</span><span class="o">(</span><span class="s1">&#39;addedPerson&#39;</span><span class="o">).</span><span class="na">start</span><span class="o">()</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">addVertex</span><span class="o">(</span><span class="n">label</span><span class="o">,</span> <span class="s1">&#39;human&#39;</span><span class="o">)</span>
<span class="n">u</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">,</span> <span class="s1">&#39;proteros&#39;</span><span class="o">)</span>
<span class="n">u</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s1">&#39;age&#39;</span><span class="o">,</span> <span class="mi">36</span><span class="o">)</span>
<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">()</span>
</pre></div>
</td></tr></table></p>
<p>Upon commit, any changes made during the transaction are logged to the
user logging system into a log named <code>addedPerson</code>. The <strong>user logging
system</strong> is a configurable logging backend with a JanusGraph compatible
log interface. By default, the log is written to a separate store in the
primary storage backend which can be configured as described below. The
log identifier specified during the start of the transaction identifies
the log in which the changes are recorded thereby allowing different
types of changes to be recorded in separate logs for individual
processing.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">tx</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">buildTransaction</span><span class="o">().</span><span class="na">logIdentifier</span><span class="o">(</span><span class="s1">&#39;battle&#39;</span><span class="o">).</span><span class="na">start</span><span class="o">()</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">traversal</span><span class="o">().</span><span class="na">V</span><span class="o">().</span><span class="na">has</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">,</span> <span class="s1">&#39;hercules&#39;</span><span class="o">).</span><span class="na">next</span><span class="o">()</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">addVertex</span><span class="o">(</span><span class="n">label</span><span class="o">,</span> <span class="s1">&#39;monster&#39;</span><span class="o">)</span>
<span class="n">m</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">,</span> <span class="s1">&#39;phylatax&#39;</span><span class="o">)</span>
<span class="n">h</span><span class="o">.</span><span class="na">addEdge</span><span class="o">(</span><span class="s1">&#39;battled&#39;</span><span class="o">,</span> <span class="n">m</span><span class="o">,</span> <span class="s1">&#39;time&#39;</span><span class="o">,</span> <span class="mi">22</span><span class="o">)</span>
<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">()</span>
</pre></div>
</td></tr></table></p>
<p>JanusGraph provides a user transaction log processor framework to
process the recorded transactional changes. The transaction log
processor is opened via
<code>JanusGraphFactory.openTransactionLog(JanusGraph)</code> against a previously
opened JanusGraph graph instance. One can then add processors for a
particular log which holds transactional changes.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.concurrent.atomic.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.janusgraph.core.log.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.*</span><span class="o">;</span>
<span class="n">logProcessor</span> <span class="o">=</span> <span class="n">JanusGraphFactory</span><span class="o">.</span><span class="na">openTransactionLog</span><span class="o">(</span><span class="n">g</span><span class="o">);</span>
<span class="n">totalHumansAdded</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="n">totalGodsAdded</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="n">logProcessor</span><span class="o">.</span><span class="na">addLogProcessor</span><span class="o">(</span><span class="s2">&quot;addedPerson&quot;</span><span class="o">).</span>
    <span class="n">setProcessorIdentifier</span><span class="o">(</span><span class="s2">&quot;addedPersonCounter&quot;</span><span class="o">).</span>
    <span class="n">setStartTimeNow</span><span class="o">().</span>
    <span class="n">addProcessor</span><span class="o">(</span><span class="k">new</span> <span class="n">ChangeProcessor</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">JanusGraphTransaction</span> <span class="n">tx</span><span class="o">,</span> <span class="n">TransactionId</span> <span class="n">txId</span><span class="o">,</span> <span class="n">ChangeState</span> <span class="n">changeState</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">v</span> <span class="k">in</span> <span class="n">changeState</span><span class="o">.</span><span class="na">getVertices</span><span class="o">(</span><span class="n">Change</span><span class="o">.</span><span class="na">ADDED</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">label</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s2">&quot;human&quot;</span><span class="o">))</span> <span class="n">totalHumansAdded</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}).</span>
    <span class="n">addProcessor</span><span class="o">(</span><span class="k">new</span> <span class="n">ChangeProcessor</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">JanusGraphTransaction</span> <span class="n">tx</span><span class="o">,</span> <span class="n">TransactionId</span> <span class="n">txId</span><span class="o">,</span> <span class="n">ChangeState</span> <span class="n">changeState</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">v</span> <span class="k">in</span> <span class="n">changeState</span><span class="o">.</span><span class="na">getVertices</span><span class="o">(</span><span class="n">Change</span><span class="o">.</span><span class="na">ADDED</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">label</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s2">&quot;god&quot;</span><span class="o">))</span> <span class="n">totalGodsAdded</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}).</span>
    <span class="n">build</span><span class="o">();</span>
</pre></div>
</td></tr></table></p>
<p>In this example, a <strong>log processor</strong> is built for the user transaction
log named <code>addedPerson</code> to process the changes made in transactions
which used the <code>addedPerson</code> log identifier. Two <strong>change processors</strong>
are added to this log processor. The first processor counts the number
of humans added and the second counts the number of gods added to the
graph.</p>
<p>When a log processor is built against a particular log, such as the
<code>addedPerson</code> log in the example above, it will start reading
transactional change records from the log immediately upon successful
construction and initialization up to the head of the log. The start
time specified in the builder marks the time point in the log where the
log processor will start reading records. Optionally, one can specify an
identifier for the log processor in the builder. The log processor will
use the identifier to regularly persist its state of processing, i.e. it
will maintain a marker on the last read log record. If the log processor
is later restarted with the same identifier, it will continue reading
from the last read record. This is particularly useful when the log
processor is supposed to run for long periods of time and is therefore
likely to fail. In such failure situations, the log processor can simply
be restarted with the same identifier. It must be ensured that log
processor identifiers are unique in a JanusGraph cluster in order to
avoid conflicts on the persisted read markers.</p>
<p>A change processor must implement the <code>ChangeProcessor</code> interface. It’s
<code>process()</code> method is invoked for each change record read from the log
with a <code>JanusGraphTransaction</code> handle, the id of the transaction that
caused the change, and a <code>ChangeState</code> container which holds the
transactional changes. The change state container can be queried to
retrieve individual elements that were part of the change state. In the
example, all added vertices are retrieved. Refer to the API
documentation for a description of all the query methods on
<code>ChangeState</code>. The provided transaction id can be used to investigate
the origin of the transaction which is uniquely identified by the
combination of the id of the JanusGraph instance that executed the
transaction (<code>txId.getInstanceId()</code>) and the instance specific
transaction id (<code>txId.getTransactionId()</code>). In addition, the time of the
transaction is available through <code>txId.getTransactionTime()</code>.</p>
<p>Change processors are executed individually and in multiple threads. If
a change processor accesses global state it must be ensured that such
state allows concurrent access. While the log processor reads log
records sequentially, the changes are processed in multiple threads so
it cannot be guaranteed that the log order is preserved in the change
processors.</p>
<p>Note, that log processors run each registered change processor at least
once for each record in the log which means that a single transactional
change record may be processed multiple times under certain failure
conditions. One cannot add or remove change processor from a running log
processor. In other words, a log processor is immutable after it is
built. To change log processing, start a new log processor and shut down
an existing one.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">logProcessor</span><span class="o">.</span><span class="na">addLogProcessor</span><span class="o">(</span><span class="s2">&quot;battle&quot;</span><span class="o">).</span>
    <span class="n">setProcessorIdentifier</span><span class="o">(</span><span class="s2">&quot;battleTimer&quot;</span><span class="o">).</span>
    <span class="n">setStartTimeNow</span><span class="o">().</span>
    <span class="n">addProcessor</span><span class="o">(</span><span class="k">new</span> <span class="n">ChangeProcessor</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">JanusGraphTransaction</span> <span class="n">tx</span><span class="o">,</span> <span class="n">TransactionId</span> <span class="n">txId</span><span class="o">,</span> <span class="n">ChangeState</span> <span class="n">changeState</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="na">V</span><span class="o">().</span><span class="na">has</span><span class="o">(</span><span class="s2">&quot;name&quot;</span><span class="o">,</span> <span class="s2">&quot;hercules&quot;</span><span class="o">).</span><span class="na">toList</span><span class="o">().</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">edge</span> <span class="k">in</span> <span class="n">changeState</span><span class="o">.</span><span class="na">getEdges</span><span class="o">(</span><span class="n">h</span><span class="o">,</span> <span class="n">Change</span><span class="o">.</span><span class="na">ADDED</span><span class="o">,</span> <span class="n">Direction</span><span class="o">.</span><span class="na">OUT</span><span class="o">,</span> <span class="s2">&quot;battled&quot;</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">edge</span><span class="o">.&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="n">value</span><span class="o">(</span><span class="s2">&quot;time&quot;</span><span class="o">)&gt;</span><span class="mi">1000</span><span class="o">)</span>
                    <span class="n">h</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s2">&quot;oldFighter&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}).</span>
    <span class="n">build</span><span class="o">();</span>
</pre></div>
</td></tr></table></p>
<p>The log processor above processes transactions for the <code>battle</code> log
identifier with a single change processor which evaluates <code>battled</code>
edges that were added to Hercules. This example demonstrates that the
transaction handle passed into the change processor is a normal
<code>JanusGraphTransaction</code> which query the JanusGraph graph and make
changes to it.</p>
<h2 id="transaction-log-use-cases">Transaction Log Use Cases</h2>
<h3 id="record-of-change">Record of Change</h3>
<p>The user transaction log can be used to keep a record of all changes
made against the graph. By using separate log identifiers, changes can
be recorded in different logs to distinguish separate transaction types.</p>
<p>At any time, a log processor can be built which can processes all
recorded changes starting from the desired start time. This can be used
for forensic analysis, to replay changes against a different graph, or
to compute an aggregate.</p>
<h3 id="downstream-updates">Downstream Updates</h3>
<p>It is often the case that a JanusGraph graph cluster is part of a larger
architecture. The user transaction log and the log processor framework
provide the tools needed to broadcast changes to other components of the
overall system without slowing down the original transactions causing
the change. This is particularly useful when transaction latencies need
to be low and/or there are a number of other systems that need to be
alerted to a change in the graph.</p>
<h3 id="triggers">Triggers</h3>
<p>The user transaction log provides the basic infrastructure to implement
triggers that can scale to a large number of concurrent transactions and
very large graphs. A trigger is registered with a particular change of
data and either triggers an event in an external system or additional
changes to the graph. At scale, it is not advisable to implement
triggers in the original transaction but rather process triggers with a
slight delay through the log processor framework. The second example
shows how changes to the graph can be evaluated and trigger additional
modifications.</p>
<h2 id="log-configuration">Log Configuration</h2>
<p>There are a number of configuration options to fine tune how the log
processor reads from the log. Refer to the complete list of
configuration options <a href="../configuration-reference/">Configuration Reference</a> for the
options under the <code>log</code> namespace. To configure the user transaction
log, use the <code>log.user</code> namespace. The options listed there allow the
configuration of the number of threads to be used, the number of log
records read in each batch, the read interval, and whether the
transaction change records should automatically expire and be removed
from the log after a configurable amount of time (TTL).</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../cache/" title="JanusGraph Cache" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                JanusGraph Cache
              </span>
            </div>
          </a>
        
        
          <a href="../configuration-reference/" title="Configuration Reference" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Configuration Reference
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 JanusGraph Authors. All rights reserved.<br> The Linux Foundation has registered trademarks and uses trademarks. For a list of<br> trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage</a> page.<br> Cassandra, Groovy, HBase, Hadoop, Lucene, Solr, and TinkerPop are trademarks of the Apache Software Foundation.<br> Berkeley DB and Berkeley DB Java Edition are trademarks of Oracle.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../theme/js/structor-menu.js"></script>
      
    
  </body>
</html>