
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-6.2.3">
    
    
      
        <title>Reindexing - JanusGraph</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3b61ea93.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.39b8e14a.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
    
    
    
      
    
    
    
      <link rel="stylesheet" href="../../theme/structor-menu.css">
    
      <link rel="stylesheet" href="../../theme/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="teal">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reindexing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="JanusGraph" class="md-header-nav__button md-logo" aria-label="JanusGraph">
      
  <img src="../../janusgraph-logomark.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            JanusGraph
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Reindexing
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/janusgraph/janusgraph/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    JanusGraph
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="JanusGraph" class="md-nav__button md-logo" aria-label="JanusGraph">
      
  <img src="../../janusgraph-logomark.svg" alt="logo">

    </a>
    JanusGraph
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/janusgraph/janusgraph/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    JanusGraph
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting-started/installation/" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting-started/basic-usage/" class="md-nav__link">
      Basic Usage
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting-started/architecture/" class="md-nav__link">
      Architectural Overview
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    
    <label class="md-nav__link" for="nav-3">
      JanusGraph Basics
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="JanusGraph Basics" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        JanusGraph Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/configuration/" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/schema/" class="md-nav__link">
      Schema and Data Modeling
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/gremlin/" class="md-nav__link">
      Gremlin Query Language
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/server/" class="md-nav__link">
      JanusGraph Server
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/deployment/" class="md-nav__link">
      Deployment Scenarios
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/configured-graph-factory/" class="md-nav__link">
      ConfiguredGraphFactory
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/multi-node/" class="md-nav__link">
      Things to Consider in a Multi-Node JanusGraph Cluster
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/transactions/" class="md-nav__link">
      Transactions
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/cache/" class="md-nav__link">
      JanusGraph Cache
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/transaction-log/" class="md-nav__link">
      Transaction Log
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/configuration-reference/" class="md-nav__link">
      Configuration Reference
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/example-config/" class="md-nav__link">
      Config Example
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/common-questions/" class="md-nav__link">
      Common Questions
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../basics/technical-limitations/" class="md-nav__link">
      Technical Limitations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Index Management
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Index Management" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Index Management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../index-performance/" class="md-nav__link">
      Indexing for Better Performance
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../index-lifecycle/" class="md-nav__link">
      Index Lifecycle
    </a>
  </li>

        
          
          
          


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Reindexing
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Reindexing
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prior-to-reindex" class="md-nav__link">
    Prior to Reindex
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-to-reindex" class="md-nav__link">
    Preparing to Reindex
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executing-a-reindex-job-on-mapreduce" class="md-nav__link">
    Executing a Reindex Job on MapReduce
  </a>
  
    <nav class="md-nav" aria-label="Executing a Reindex Job on MapReduce">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reindex-example-on-mapreduce" class="md-nav__link">
    Reindex Example on MapReduce
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executing-a-reindex-job-on-janusgraphmanagement" class="md-nav__link">
    Executing a Reindex job on JanusGraphManagement
  </a>
  
    <nav class="md-nav" aria-label="Executing a Reindex job on JanusGraphManagement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-for-janusgraphmanagement" class="md-nav__link">
    Example for JanusGraphManagement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-problems" class="md-nav__link">
    Common problems
  </a>
  
    <nav class="md-nav" aria-label="Common problems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#illegalargumentexception-when-starting-job" class="md-nav__link">
    IllegalArgumentException when starting job
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#could-not-find-index" class="md-nav__link">
    Could not find index
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cassandra-mappers-fail-with-too-many-open-files" class="md-nav__link">
    Cassandra Mappers Fail with "Too many open files"
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../index-removal/" class="md-nav__link">
      Removal
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
    
    <label class="md-nav__link" for="nav-5">
      Storage Backends
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Storage Backends" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Storage Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../storage-backend/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../storage-backend/cassandra/" class="md-nav__link">
      Apache Cassandra
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../storage-backend/hbase/" class="md-nav__link">
      Apache HBase
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../storage-backend/bigtable/" class="md-nav__link">
      Google Cloud Bigtable
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../storage-backend/bdb/" class="md-nav__link">
      Oracle Berkeley DB Java Edition
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../storage-backend/inmemorybackend/" class="md-nav__link">
      InMemory Storage Backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
    
    <label class="md-nav__link" for="nav-6">
      Mixed Index Backends
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Mixed Index Backends" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Mixed Index Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../index-backend/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../index-backend/search-predicates/" class="md-nav__link">
      Search Predicates and Data Types
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../index-backend/text-search/" class="md-nav__link">
      Index Parameters and Full-Text Search
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../index-backend/field-mapping/" class="md-nav__link">
      Field Mapping
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../index-backend/direct-index-query/" class="md-nav__link">
      Direct Index Query
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../index-backend/elasticsearch/" class="md-nav__link">
      Elasticsearch
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../index-backend/solr/" class="md-nav__link">
      Apache Solr
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../index-backend/lucene/" class="md-nav__link">
      Apache Lucene
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
    
    <label class="md-nav__link" for="nav-7">
      Advanced Topics
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Advanced Topics" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Advanced Topics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-topics/advschema/" class="md-nav__link">
      Advanced Schema
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-topics/eventual-consistency/" class="md-nav__link">
      Eventually-Consistent Storage Backends
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-topics/recovery/" class="md-nav__link">
      Failure & Recovery
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-topics/bulk-loading/" class="md-nav__link">
      Bulk Loading
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-topics/partitioning/" class="md-nav__link">
      Graph Partitioning
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-topics/serializer/" class="md-nav__link">
      Datatype and Attribute Serializer Configuration
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-topics/hadoop/" class="md-nav__link">
      JanusGraph with TinkerPop’s Hadoop-Gremlin
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-topics/monitoring/" class="md-nav__link">
      Monitoring JanusGraph
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-topics/migrating/" class="md-nav__link">
      Migrating from Titan
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-topics/data-model/" class="md-nav__link">
      JanusGraph Data model
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../advanced-topics/janusgraph-bus/" class="md-nav__link">
      JanusGraph Bus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
    
    <label class="md-nav__link" for="nav-8">
      Connecting to JanusGraph
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Connecting to JanusGraph" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Connecting to JanusGraph
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../connecting/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../connecting/java/" class="md-nav__link">
      Using Java
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../connecting/python/" class="md-nav__link">
      Using Python
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="../../connecting/dotnet/" class="md-nav__link">
      Using .Net
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../../development/" class="md-nav__link">
      Development
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../../appendices/" class="md-nav__link">
      Appendices
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../../changelog/" class="md-nav__link">
      Changelog
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prior-to-reindex" class="md-nav__link">
    Prior to Reindex
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-to-reindex" class="md-nav__link">
    Preparing to Reindex
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executing-a-reindex-job-on-mapreduce" class="md-nav__link">
    Executing a Reindex Job on MapReduce
  </a>
  
    <nav class="md-nav" aria-label="Executing a Reindex Job on MapReduce">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reindex-example-on-mapreduce" class="md-nav__link">
    Reindex Example on MapReduce
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executing-a-reindex-job-on-janusgraphmanagement" class="md-nav__link">
    Executing a Reindex job on JanusGraphManagement
  </a>
  
    <nav class="md-nav" aria-label="Executing a Reindex job on JanusGraphManagement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-for-janusgraphmanagement" class="md-nav__link">
    Example for JanusGraphManagement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-problems" class="md-nav__link">
    Common problems
  </a>
  
    <nav class="md-nav" aria-label="Common problems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#illegalargumentexception-when-starting-job" class="md-nav__link">
    IllegalArgumentException when starting job
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#could-not-find-index" class="md-nav__link">
    Could not find index
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cassandra-mappers-fail-with-too-many-open-files" class="md-nav__link">
    Cassandra Mappers Fail with "Too many open files"
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/janusgraph/janusgraph/edit/v0.5/docs/index-management/index-reindexing.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="reindexing">Reindexing</h1>
<p><a href="../index-performance/#graph-index">Graph Index</a> and 
<a href="../index-performance/#vertex-centric-indexes">Vertex-centric Indexes</a> 
describe how to build
graph-global and vertex-centric indexes to improve query performance.
These indexes are immediately available if the indexed keys or labels
have been newly defined in the same management transaction. In this
case, there is no need to reindex the graph and this section can be
skipped. If the indexed keys and labels already existed prior to index
construction it is necessary to reindex the entire graph in order to
ensure that the index contains previously added elements. This section
describes the reindexing process.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Reindexing is a manual process comprised of multiple steps. These
steps must be carefully followed in the right order to avoid index
inconsistencies.</p>
</div>
<h2 id="overview">Overview</h2>
<p>JanusGraph can begin writing incremental index updates right after an
index is defined. However, before the index is complete and usable,
JanusGraph must also take a one-time read pass over all existing graph
elements associated with the newly indexed schema type(s). Once this
reindexing job has completed, the index is fully populated and ready to
be used. The index must then be enabled to be used during query
processing.</p>
<h2 id="prior-to-reindex">Prior to Reindex</h2>
<p>The starting point of the reindexing process is the construction of an
index. Refer to <a href="../index-performance/">Indexing for Better Performance</a> for a complete discussion of global
graph and vertex-centric indexes. Note, that a global graph index is
uniquely identified by its name. A vertex-centric index is uniquely
identified by the combination of its name and the edge label or property
key on which the index is defined - the name of the latter is referred
to as the <strong>index type</strong> in this section and only applies to
vertex-centric indexes.</p>
<p>After building a new index against existing schema elements it is
recommended to wait a few minutes for the index to be announced to the
cluster. Note the index name (and the index type in case of a
vertex-centric index) since this information is needed when reindexing.</p>
<h2 id="preparing-to-reindex">Preparing to Reindex</h2>
<p>There is a choice between two execution frameworks for reindex jobs:</p>
<ul>
<li>MapReduce</li>
<li>JanusGraphManagement</li>
</ul>
<p>Reindex on MapReduce supports large, horizontally-distributed databases.
Reindex on JanusGraphManagement spawns a single-machine OLAP job. This
is intended for convenience and speed on those databases small enough to
be handled by one machine.</p>
<p>Reindexing requires:</p>
<ul>
<li>The index name (a string — the user provides this to JanusGraph when
    building a new index)</li>
<li>The index type (a string — the name of the edge label or property
    key on which the vertex-centric index is built). This applies only
    to vertex-centric indexes - leave blank for global graph indexes.</li>
</ul>
<h2 id="executing-a-reindex-job-on-mapreduce">Executing a Reindex Job on MapReduce</h2>
<p>The recommended way to generate and run a reindex job on MapReduce is
through the <code>MapReduceIndexManagement</code> class. Here is a rough outline of
the steps to run a reindex job using this class:</p>
<ul>
<li>Open a <code>JanusGraph</code> instance</li>
<li>Pass the graph instance into <code>MapReduceIndexManagement</code>'s constructor</li>
<li>Call <code>updateIndex(&lt;index&gt;, SchemaAction.REINDEX)</code> on the <code>MapReduceIndexManagement</code> instance</li>
<li>If the index has not yet been enabled, enable it through <code>JanusGraphManagement</code></li>
</ul>
<p>This class implements an <code>updateIndex</code> method that supports only the
<code>REINDEX</code> and <code>REMOVE_INDEX</code> actions for its <code>SchemaAction</code> parameter.
The class starts a Hadoop MapReduce job using the Hadoop configuration
and jars on the classpath. Both Hadoop 1 and 2 are supported. This class
gets metadata about the index and storage backend (e.g. the Cassandra
partitioner) from the <code>JanusGraph</code> instance given to its constructor.
<div class="highlight"><pre><span></span><code><span class="n">graph</span> <span class="o">=</span> <span class="n">JanusGraphFactory</span><span class="o">.</span><span class="na">open</span><span class="o">(...)</span>
<span class="n">mgmt</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">openManagement</span><span class="o">()</span>
<span class="n">mr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapReduceIndexManagement</span><span class="o">(</span><span class="n">graph</span><span class="o">)</span>
<span class="n">mr</span><span class="o">.</span><span class="na">updateIndex</span><span class="o">(</span><span class="n">mgmt</span><span class="o">.</span><span class="na">getRelationIndex</span><span class="o">(</span><span class="n">mgmt</span><span class="o">.</span><span class="na">getRelationType</span><span class="o">(</span><span class="s2">&quot;battled&quot;</span><span class="o">),</span> <span class="s2">&quot;battlesByTime&quot;</span><span class="o">),</span> <span class="n">SchemaAction</span><span class="o">.</span><span class="na">REINDEX</span><span class="o">).</span><span class="na">get</span><span class="o">()</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">commit</span><span class="o">()</span>
</code></pre></div></p>
<h3 id="reindex-example-on-mapreduce">Reindex Example on MapReduce</h3>
<p>The following Gremlin snippet outlines all steps of the MapReduce
reindex process in one self-contained example using minimal dummy data
against the Cassandra storage backend.
<div class="highlight"><pre><span></span><code><span class="c1">// Open a graph</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">JanusGraphFactory</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s2">&quot;conf/janusgraph-cql-es.properties&quot;</span><span class="o">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">traversal</span><span class="o">()</span>

<span class="c1">// Define a property</span>
<span class="n">mgmt</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">openManagement</span><span class="o">()</span>
<span class="n">desc</span> <span class="o">=</span> <span class="n">mgmt</span><span class="o">.</span><span class="na">makePropertyKey</span><span class="o">(</span><span class="s2">&quot;desc&quot;</span><span class="o">).</span><span class="na">dataType</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">make</span><span class="o">()</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">commit</span><span class="o">()</span>

<span class="c1">// Insert some data</span>
<span class="n">graph</span><span class="o">.</span><span class="na">addVertex</span><span class="o">(</span><span class="s2">&quot;desc&quot;</span><span class="o">,</span> <span class="s2">&quot;foo bar&quot;</span><span class="o">)</span>
<span class="n">graph</span><span class="o">.</span><span class="na">addVertex</span><span class="o">(</span><span class="s2">&quot;desc&quot;</span><span class="o">,</span> <span class="s2">&quot;foo baz&quot;</span><span class="o">)</span>
<span class="n">graph</span><span class="o">.</span><span class="na">tx</span><span class="o">().</span><span class="na">commit</span><span class="o">()</span>

<span class="c1">// Run a query -- note the planner warning recommending the use of an index</span>
<span class="n">g</span><span class="o">.</span><span class="na">V</span><span class="o">().</span><span class="na">has</span><span class="o">(</span><span class="s2">&quot;desc&quot;</span><span class="o">,</span> <span class="n">containsText</span><span class="o">(</span><span class="s2">&quot;baz&quot;</span><span class="o">))</span>

<span class="c1">// Create an index</span>
<span class="n">mgmt</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">openManagement</span><span class="o">()</span>

<span class="n">desc</span> <span class="o">=</span> <span class="n">mgmt</span><span class="o">.</span><span class="na">getPropertyKey</span><span class="o">(</span><span class="s2">&quot;desc&quot;</span><span class="o">)</span>
<span class="n">mixedIndex</span> <span class="o">=</span> <span class="n">mgmt</span><span class="o">.</span><span class="na">buildIndex</span><span class="o">(</span><span class="s2">&quot;mixedExample&quot;</span><span class="o">,</span> <span class="n">Vertex</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">addKey</span><span class="o">(</span><span class="n">desc</span><span class="o">).</span><span class="na">buildMixedIndex</span><span class="o">(</span><span class="s2">&quot;search&quot;</span><span class="o">)</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">commit</span><span class="o">()</span>

<span class="c1">// Rollback or commit transactions on the graph which predate the index definition</span>
<span class="n">graph</span><span class="o">.</span><span class="na">tx</span><span class="o">().</span><span class="na">rollback</span><span class="o">()</span>

<span class="c1">// Block until the SchemaStatus transitions from INSTALLED to REGISTERED</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">ManagementSystem</span><span class="o">.</span><span class="na">awaitGraphIndexStatus</span><span class="o">(</span><span class="n">graph</span><span class="o">,</span> <span class="s2">&quot;mixedExample&quot;</span><span class="o">).</span><span class="na">call</span><span class="o">()</span>

<span class="c1">// Run a JanusGraph-Hadoop job to reindex</span>
<span class="n">mgmt</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">openManagement</span><span class="o">()</span>
<span class="n">mr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapReduceIndexManagement</span><span class="o">(</span><span class="n">graph</span><span class="o">)</span>
<span class="n">mr</span><span class="o">.</span><span class="na">updateIndex</span><span class="o">(</span><span class="n">mgmt</span><span class="o">.</span><span class="na">getGraphIndex</span><span class="o">(</span><span class="s2">&quot;mixedExample&quot;</span><span class="o">),</span> <span class="n">SchemaAction</span><span class="o">.</span><span class="na">REINDEX</span><span class="o">).</span><span class="na">get</span><span class="o">()</span>

<span class="c1">// Enable the index</span>
<span class="n">mgmt</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">openManagement</span><span class="o">()</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">updateIndex</span><span class="o">(</span><span class="n">mgmt</span><span class="o">.</span><span class="na">getGraphIndex</span><span class="o">(</span><span class="s2">&quot;mixedExample&quot;</span><span class="o">),</span> <span class="n">SchemaAction</span><span class="o">.</span><span class="na">ENABLE_INDEX</span><span class="o">).</span><span class="na">get</span><span class="o">()</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">commit</span><span class="o">()</span>

<span class="c1">// Block until the SchemaStatus is ENABLED</span>
<span class="n">mgmt</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">openManagement</span><span class="o">()</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">ManagementSystem</span><span class="o">.</span><span class="na">awaitGraphIndexStatus</span><span class="o">(</span><span class="n">graph</span><span class="o">,</span> <span class="s2">&quot;mixedExample&quot;</span><span class="o">).</span><span class="na">status</span><span class="o">(</span><span class="n">SchemaStatus</span><span class="o">.</span><span class="na">ENABLED</span><span class="o">).</span><span class="na">call</span><span class="o">()</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">rollback</span><span class="o">()</span>

<span class="c1">// Run a query -- JanusGraph will use the new index, no planner warning</span>
<span class="n">g</span><span class="o">.</span><span class="na">V</span><span class="o">().</span><span class="na">has</span><span class="o">(</span><span class="s2">&quot;desc&quot;</span><span class="o">,</span> <span class="n">containsText</span><span class="o">(</span><span class="s2">&quot;baz&quot;</span><span class="o">))</span>

<span class="c1">// Concerned that JanusGraph could have read cache in that last query, instead of relying on the index?</span>
<span class="c1">// Start a new instance to rule out cache hits.  Now we&#39;re definitely using the index.</span>
<span class="n">graph</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">JanusGraphFactory</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s2">&quot;conf/janusgraph-cql-es.properties&quot;</span><span class="o">)</span>
<span class="n">g</span><span class="o">.</span><span class="na">V</span><span class="o">().</span><span class="na">has</span><span class="o">(</span><span class="s2">&quot;desc&quot;</span><span class="o">,</span> <span class="n">containsText</span><span class="o">(</span><span class="s2">&quot;baz&quot;</span><span class="o">))</span>
</code></pre></div></p>
<h2 id="executing-a-reindex-job-on-janusgraphmanagement">Executing a Reindex job on JanusGraphManagement</h2>
<p>To run a reindex job on JanusGraphManagement, invoke
<code>JanusGraphManagement.updateIndex</code> with the <code>SchemaAction.REINDEX</code>
argument. For example:
<div class="highlight"><pre><span></span><code><span class="n">m</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">openManagement</span><span class="o">()</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="na">getGraphIndex</span><span class="o">(</span><span class="s1">&#39;indexName&#39;</span><span class="o">)</span>
<span class="n">m</span><span class="o">.</span><span class="na">updateIndex</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">SchemaAction</span><span class="o">.</span><span class="na">REINDEX</span><span class="o">).</span><span class="na">get</span><span class="o">()</span>
<span class="n">m</span><span class="o">.</span><span class="na">commit</span><span class="o">()</span>
</code></pre></div></p>
<h3 id="example-for-janusgraphmanagement">Example for JanusGraphManagement</h3>
<p>The following loads some sample data into a BerkeleyDB-backed JanusGraph
database, defines an index after the fact, reindexes using
JanusGraphManagement, and finally enables and uses the index:
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">org.janusgraph.graphdb.database.management.ManagementSystem</span>

<span class="c1">// Load some data from a file without any predefined schema</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">JanusGraphFactory</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s1">&#39;conf/janusgraph-berkeleyje.properties&#39;</span><span class="o">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">traversal</span><span class="o">()</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">openManagement</span><span class="o">()</span>
<span class="n">m</span><span class="o">.</span><span class="na">makePropertyKey</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">).</span><span class="na">dataType</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">cardinality</span><span class="o">(</span><span class="n">Cardinality</span><span class="o">.</span><span class="na">LIST</span><span class="o">).</span><span class="na">make</span><span class="o">()</span>
<span class="n">m</span><span class="o">.</span><span class="na">makePropertyKey</span><span class="o">(</span><span class="s1">&#39;lang&#39;</span><span class="o">).</span><span class="na">dataType</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">cardinality</span><span class="o">(</span><span class="n">Cardinality</span><span class="o">.</span><span class="na">LIST</span><span class="o">).</span><span class="na">make</span><span class="o">()</span>
<span class="n">m</span><span class="o">.</span><span class="na">makePropertyKey</span><span class="o">(</span><span class="s1">&#39;age&#39;</span><span class="o">).</span><span class="na">dataType</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">cardinality</span><span class="o">(</span><span class="n">Cardinality</span><span class="o">.</span><span class="na">LIST</span><span class="o">).</span><span class="na">make</span><span class="o">()</span>
<span class="n">m</span><span class="o">.</span><span class="na">commit</span><span class="o">()</span>
<span class="n">graph</span><span class="o">.</span><span class="na">io</span><span class="o">(</span><span class="n">IoCore</span><span class="o">.</span><span class="na">gryo</span><span class="o">()).</span><span class="na">readGraph</span><span class="o">(</span><span class="s1">&#39;data/tinkerpop-modern.gio&#39;</span><span class="o">)</span>
<span class="n">graph</span><span class="o">.</span><span class="na">tx</span><span class="o">().</span><span class="na">commit</span><span class="o">()</span>

<span class="c1">// Run a query -- note the planner warning recommending the use of an index</span>
<span class="n">g</span><span class="o">.</span><span class="na">V</span><span class="o">().</span><span class="na">has</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">,</span> <span class="s1">&#39;lop&#39;</span><span class="o">)</span>
<span class="n">graph</span><span class="o">.</span><span class="na">tx</span><span class="o">().</span><span class="na">rollback</span><span class="o">()</span>

<span class="c1">// Create an index</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">openManagement</span><span class="o">()</span>
<span class="n">m</span><span class="o">.</span><span class="na">buildIndex</span><span class="o">(</span><span class="s1">&#39;names&#39;</span><span class="o">,</span> <span class="n">Vertex</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">addKey</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">getPropertyKey</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">)).</span><span class="na">buildCompositeIndex</span><span class="o">()</span>
<span class="n">m</span><span class="o">.</span><span class="na">commit</span><span class="o">()</span>
<span class="n">graph</span><span class="o">.</span><span class="na">tx</span><span class="o">().</span><span class="na">commit</span><span class="o">()</span>

<span class="c1">// Block until the SchemaStatus transitions from INSTALLED to REGISTERED</span>
<span class="n">ManagementSystem</span><span class="o">.</span><span class="na">awaitGraphIndexStatus</span><span class="o">(</span><span class="n">graph</span><span class="o">,</span> <span class="s1">&#39;names&#39;</span><span class="o">).</span><span class="na">status</span><span class="o">(</span><span class="n">SchemaStatus</span><span class="o">.</span><span class="na">REGISTERED</span><span class="o">).</span><span class="na">call</span><span class="o">()</span>

<span class="c1">// Reindex using JanusGraphManagement</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">openManagement</span><span class="o">()</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="na">getGraphIndex</span><span class="o">(</span><span class="s1">&#39;names&#39;</span><span class="o">)</span>
<span class="n">m</span><span class="o">.</span><span class="na">updateIndex</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">SchemaAction</span><span class="o">.</span><span class="na">REINDEX</span><span class="o">)</span>
<span class="n">m</span><span class="o">.</span><span class="na">commit</span><span class="o">()</span>

<span class="c1">// Enable the index</span>
<span class="n">ManagementSystem</span><span class="o">.</span><span class="na">awaitGraphIndexStatus</span><span class="o">(</span><span class="n">graph</span><span class="o">,</span> <span class="s1">&#39;names&#39;</span><span class="o">).</span><span class="na">status</span><span class="o">(</span><span class="n">SchemaStatus</span><span class="o">.</span><span class="na">ENABLED</span><span class="o">).</span><span class="na">call</span><span class="o">()</span>

<span class="c1">// Run a query -- JanusGraph will use the new index, no planner warning</span>
<span class="n">g</span><span class="o">.</span><span class="na">V</span><span class="o">().</span><span class="na">has</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">,</span> <span class="s1">&#39;lop&#39;</span><span class="o">)</span>
<span class="n">graph</span><span class="o">.</span><span class="na">tx</span><span class="o">().</span><span class="na">rollback</span><span class="o">()</span>

<span class="c1">// Concerned that JanusGraph could have read cache in that last query, instead of relying on the index?</span>
<span class="c1">// Start a new instance to rule out cache hits.  Now we&#39;re definitely using the index.</span>
<span class="n">graph</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">JanusGraphFactory</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s2">&quot;conf/janusgraph-berkeleyje.properties&quot;</span><span class="o">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">traversal</span><span class="o">()</span>
<span class="n">g</span><span class="o">.</span><span class="na">V</span><span class="o">().</span><span class="na">has</span><span class="o">(</span><span class="s1">&#39;name&#39;</span><span class="o">,</span> <span class="s1">&#39;lop&#39;</span><span class="o">)</span>
</code></pre></div></p>
<h2 id="common-problems">Common problems</h2>
<h3 id="illegalargumentexception-when-starting-job">IllegalArgumentException when starting job</h3>
<p>When a reindexing job is started shortly after a the index has been
built, the job might fail with an exception like one of the following:</p>
<div class="codehilite"><pre><span></span><code><span class="n">The</span> <span class="k">index</span> <span class="n">mixedExample</span> <span class="k">is</span> <span class="k">in</span> <span class="n">an</span> <span class="n">invalid</span> <span class="k">state</span> <span class="k">and</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">indexed</span><span class="p">.</span>
<span class="n">The</span> <span class="n">following</span> <span class="k">index</span> <span class="n">keys</span> <span class="n">have</span> <span class="n">invalid</span> <span class="n">status</span><span class="p">:</span> <span class="k">desc</span> <span class="n">has</span> <span class="n">status</span> <span class="n">INSTALLED</span>
<span class="p">(</span><span class="n">status</span> <span class="n">must</span> <span class="n">be</span> <span class="n">one</span> <span class="k">of</span> <span class="p">[</span><span class="n">REGISTERED</span><span class="p">,</span> <span class="n">ENABLED</span><span class="p">])</span>

<span class="n">The</span> <span class="k">index</span> <span class="n">mixedExample</span> <span class="k">is</span> <span class="k">in</span> <span class="n">an</span> <span class="n">invalid</span> <span class="k">state</span> <span class="k">and</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">indexed</span><span class="p">.</span>
<span class="n">The</span> <span class="k">index</span> <span class="n">has</span> <span class="n">status</span> <span class="n">INSTALLED</span><span class="p">,</span> <span class="n">but</span> <span class="n">one</span> <span class="k">of</span> <span class="p">[</span><span class="n">REGISTERED</span><span class="p">,</span> <span class="n">ENABLED</span><span class="p">]</span> <span class="k">is</span> <span class="n">required</span>
</code></pre></div>


<p>When an index is built, its existence is broadcast to all other
JanusGraph instances in the cluster. Those must acknowledge the
existence of the index before the reindexing process can be started. The
acknowledgments can take a while to come in depending on the size of the
cluster and the connection speed. Hence, one should wait a few minutes
after building the index and before starting the reindex process.</p>
<p>Note, that the acknowledgment might fail due to JanusGraph instance
failure. In other words, the cluster might wait indefinitely on the
acknowledgment of a failed instance. In this case, the user must
manually remove the failed instance from the cluster registry as
described in <a href="../../advanced-topics/recovery/">Failure &amp; Recovery</a>. After the cluster state has been
restored, the acknowledgment process must be reinitiated by manually
registering the index again in the management system.</p>
<div class="highlight"><pre><span></span><code><span class="n">mgmt</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">openManagement</span><span class="o">()</span>
<span class="n">rindex</span> <span class="o">=</span> <span class="n">mgmt</span><span class="o">.</span><span class="na">getRelationIndex</span><span class="o">(</span><span class="n">mgmt</span><span class="o">.</span><span class="na">getRelationType</span><span class="o">(</span><span class="s2">&quot;battled&quot;</span><span class="o">),</span><span class="s2">&quot;battlesByTime&quot;</span><span class="o">)</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">updateIndex</span><span class="o">(</span><span class="n">rindex</span><span class="o">,</span> <span class="n">SchemaAction</span><span class="o">.</span><span class="na">REGISTER_INDEX</span><span class="o">).</span><span class="na">get</span><span class="o">()</span>
<span class="n">gindex</span> <span class="o">=</span> <span class="n">mgmt</span><span class="o">.</span><span class="na">getGraphIndex</span><span class="o">(</span><span class="s2">&quot;byName&quot;</span><span class="o">)</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">updateIndex</span><span class="o">(</span><span class="n">gindex</span><span class="o">,</span> <span class="n">SchemaAction</span><span class="o">.</span><span class="na">REGISTER_INDEX</span><span class="o">).</span><span class="na">get</span><span class="o">()</span>
<span class="n">mgmt</span><span class="o">.</span><span class="na">commit</span><span class="o">()</span>
</code></pre></div>

<p>After waiting a few minutes for the acknowledgment to arrive the reindex
job should start successfully.</p>
<h3 id="could-not-find-index">Could not find index</h3>
<p>This exception in the reindexing job indicates that an index with the
given name does not exist or that the name has not been specified
correctly. When reindexing a global graph index, only the name of the
index as defined when building the index should be specified. When
reindexing a global graph index, the name of the index must be given in
addition to the name of the edge label or property key on which the
vertex-centric index is defined.</p>
<h3 id="cassandra-mappers-fail-with-too-many-open-files">Cassandra Mappers Fail with "Too many open files"</h3>
<p>The end of the exception stacktrace may look like this:
<div class="highlight"><pre><span></span><code><span class="n">java</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">SocketException</span><span class="p">:</span> <span class="n">Too</span> <span class="n">many</span> <span class="n">open</span> <span class="n">files</span>
    <span class="n">at</span> <span class="n">java</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">Socket</span><span class="p">.</span><span class="na">createImpl</span><span class="p">(</span><span class="n">Socket</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">447</span><span class="p">)</span>
    <span class="n">at</span> <span class="n">java</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">Socket</span><span class="p">.</span><span class="na">getImpl</span><span class="p">(</span><span class="n">Socket</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">510</span><span class="p">)</span>
    <span class="n">at</span> <span class="n">java</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">Socket</span><span class="p">.</span><span class="na">setSoLinger</span><span class="p">(</span><span class="n">Socket</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">988</span><span class="p">)</span>
    <span class="n">at</span> <span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">thrift</span><span class="p">.</span><span class="na">transport</span><span class="p">.</span><span class="na">TSocket</span><span class="p">.</span><span class="na">initSocket</span><span class="p">(</span><span class="n">TSocket</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">118</span><span class="p">)</span>
    <span class="n">at</span> <span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">thrift</span><span class="p">.</span><span class="na">transport</span><span class="p">.</span><span class="na">TSocket</span><span class="p">.</span><span class="o">&lt;</span><span class="n">init</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TSocket</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="mi">109</span><span class="p">)</span>
</code></pre></div></p>
<p>When running Cassandra with virtual nodes enabled, the number of virtual
nodes seems to set a floor under the number of mappers. Cassandra may
generate more mappers than virtual nodes for clusters with lots of data,
but it seems to generate at least as many mappers as there are virtual
nodes even though the cluster might be empty or close to empty. The
default is 256 as of this writing.</p>
<p>Each mapper opens and quickly closes several sockets to Cassandra. The
kernel on the client side of those closed sockets goes into asynchronous
TIME_WAIT, since Thrift uses SO_LINGER. Only a small number of sockets
are open at any one time — usually low single digits — but potentially
many lingering sockets can accumulate in TIME_WAIT. This accumulation
is most pronounced when running a reindex job locally (not on a
distributed MapReduce cluster), since all of those client-side
TIME_WAIT sockets are lingering on a single client machine instead of
being spread out across many machines in a cluster. Combined with the
floor of 256 mappers, a reindex job can open thousands of sockets of the
course of its execution. When these sockets all linger in TIME_WAIT on
the same client, they have the potential to reach the open-files ulimit,
which also controls the number of open sockets. The open-files ulimit is
often set to 1024.</p>
<p>Here are a few suggestions for dealing with the "Too many open files"
problem during reindexing on a single machine:</p>
<ul>
<li>
<p>Reduce the maximum size of the Cassandra connection pool. For
    example, consider setting the cassandrathrift storage backend’s
    <code>max-active</code> and <code>max-idle</code> options to 1 each, and setting
    <code>max-total</code> to -1. See <a href="../../basics/configuration-reference/">Configuration Reference</a> for full listings of
    connection pool settings on the Cassandra storage backends.</p>
</li>
<li>
<p>Increase the <code>nofile</code> ulimit. The ideal value depends on the size of
    the Cassandra dataset and the throughput of the reindex mappers; if
    starting at 1024, try an order of magnitude larger: 10000. This is
    just necessary to sustain lingering TIME_WAIT sockets. The reindex
    job won’t try to open nearly that many sockets at once.</p>
</li>
<li>
<p>Run the reindex task on a multi-node MapReduce cluster to spread out
    the socket load.</p>
</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../index-lifecycle/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Index Lifecycle
              </div>
            </div>
          </a>
        
        
          <a href="../index-removal/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Removal
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 JanusGraph Authors. All rights reserved.<br> The Linux Foundation has registered trademarks and uses trademarks. For a list of<br> trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage">Trademark Usage</a> page.<br> Cassandra, Groovy, HBase, Hadoop, Lucene, Solr, and TinkerPop are trademarks of the Apache Software Foundation.<br> Berkeley DB and Berkeley DB Java Edition are trademarks of Oracle.
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.08c56446.min.js"></script>
      <script src="../../assets/javascripts/bundle.6ced434e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../../theme/js/structor-menu.js"></script>
      
    
  </body>
</html>